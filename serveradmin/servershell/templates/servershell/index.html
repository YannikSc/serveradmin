{% extends "base.html" %}
{% load serversearch %}
{% block title %}Servershell{% endblock %}

{% block additional_styles %}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/jquery-ui.min.css">
{% endblock %}

{% block content %}
    <!-- Servershell input controls -->
    <div class="form-group row">
        <label for="search" class="col-sm-1 col-form-label">Search:</label>
        <div class="col-sm-8">
            <form method="post" action="" id="search_form">
                {% csrf_token %}
                <input class="form-control form-control-sm" type="text" id="search" value="{{ search_term }}" />
            </form>
        </div>
        <img src="{{ STATIC_URL }}icons/question.svg" width="25px" height="25px" alt="search help" data-toggle="modal" data-target="#help"/>
    </div>
    <div class="form-group row">
        <label for="command" class="col-sm-1 col-form-label">Command:</label>
        <div class="col-sm-8">
            <form method="post" action="javascript:return false;" id="shell_command_form">
                <input class="form-control form-control-sm" type="text" size="60"  id="command" />
            </form>
        </div>
        <img src="{{ STATIC_URL }}icons/question.svg" width="25px" height="25px" alt="commands help"/>
    </div>
    <div class="form-group row">
        <label for="understood" class="col-sm-1 col-form-label">Understood:</label>
        <div class="col-sm-8">
            <input id="understood" class="form-control form-control-sm" type="text" readonly="readonly"/>
        </div>
        <a href="?term" id="search_link">
            <img src="{{ STATIC_URL }}icons/bookmark.svg" width="25px" height="25px" alt="open search in new tab"/>
        </a>
    </div>

    <hr/>

    <!-- The help for the modals in the servershell -->
    {% include "servershell/index_help.html" %}

    <div class="row">
        <div class="col-md-10">
            <div id="shell_servers">
                <table class="table table-bordered table-hover table-sm">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        <div class="col-md-2">
            <!-- The attributes selection for the results -->
            {% include "servershell/index_attributes.html" %}
        </div>
    </div>

{% endblock %}

{% block additional_scripts %}
    {% serversearch_js 'search' %}
    <script type="text/javascript">
    //<![CDATA[
    var shell_history = {
        'commands': {{ command_history|safe }}
    };
    shell_history['index'] = shell_history['commands'].length;
    var shell_results_url = "{% url 'servershell_results' %}";
    var shell_export_url = "{% url 'servershell_export' %}";
    var shell_inspect_url = "{% url 'servershell_inspect' %}";
    var shell_edit_url = "{% url 'servershell_edit' %}";
    var shell_commit_url = "{% url 'servershell_commit' %}";
    var shell_values_url = "{% url 'servershell_values' %}";
    var shell_new_url = "{% url 'servershell_new' %}";
    var shell_clone_url = "{% url 'servershell_clone' %}";
    var shell_graph_url = "{% url 'graphite_graph_table' %}";
    var shell_changes_url = "{% url 'serverdb_changes' %}";
    var shell_store_command_url = "{% url 'servershell_store_command' %}";
    var serverdb_history_url = "{% url 'serverdb_history' %}";
    //]]>
    </script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/common.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/servershell.js"></script>
    <script type="text/javascript">
    //<![CDATA[
    search['per_page'] = {{ per_page }};
    //]]>

    $('#search').select();
    </script>
{% endblock %}
